# WebAPP封装和推送

## 参考文档

* [Android消息推送：手把手教你集成小米推送](https://www.jianshu.com/p/b1134bebc2d4)
* [Android消息推送：第三方消息推送平台详细解析](https://www.jianshu.com/p/d77eaca4e52a)
* [手把手教你实现iOS 远程推送](https://www.jianshu.com/p/2c8cf1ccf625)
* [iOS两种推送方式的区别](https://www.jianshu.com/p/7c9678704ae2)
* [变色龙WApp帮助](https://www.kancloud.cn/bslapp/wapp/1007582)
* [统一推送联盟](http://chinaupa.com/)

## 关于WebAPP

## 原理

### 封装原理

通过APP中内置浏览核心, 在APP打开时访问相应网站主页, 从而达到将网站页面转换为APP的效果, 从而实现一次开发多端上线

### 推送原理

#### 推送类型

* `Pull` 主动获取: 客户端固定时间从服务器获取信息, 基于短连接
* `Push` 被动接受: 服务器直接推送到在线客户端, 基于长连接

#### 主要推送平台以及其他方式

* `APNs` (Apple Push Notification service, Apple) 实现依据的是服务器和客户端的长连接，信息通过服务器主动 `push` 给客户端
* `C2DM` (Cloud to Device Messaging 云端推送, Google) Android系统级别的消息推送服务
* 国内的Android第三方平台(小米, 华为, 友盟, 极光, 云巴, 阿里云移动, 腾讯信鸽, 百度云等...)
* 国内的Apple第三方平台(极光, 环信, 融云等...)

其他不建议的自我搭建方式, 多为以上列举相关平台的实现方法

* `轮询` 基于 `Pull` 方式自己开发, 需要考虑诸多因素相当于自己建立整个推送机制
* `SMS信令` 通过发送类似短信的`信令`的方式, 并由客户端拦截`信令`解析内容获取信息
* `MQTT协议` 自己搭建推送平台的方式
* `XMPP协议` 自己搭建推送平台的方式

Google服务国内无法连接, 为了多快好省只能选择国内的第三方厂商, Apple则可以选择直接使用其服务, 无需选择第三方厂商

#### Android第三方选择思路

在给出相关优缺点的比较之前先要谈一个更加重要的问题, 即本节的内容

##### 手机保有量

由于不同的安卓手机系统对于推送进程系统的对待不同, 例如: google原生android系统不会杀死C2DM服务, 小米MIUI不会杀死小米推送

所以手机保有量对于选择何种推送息息相关

##### 跟风选推送

在安卓推送的当前情况下跟风选择第三方推送是非常合理的, 因为推送系统会共享一条推送渠道, 例如: 腾讯新闻与淘宝同时使用小米推送, 当小米推送被华为手机系统杀死, 但是用户刚刚打开了淘宝, 那么腾讯新闻同样能完成推送

#### 推送方式

一般第三方推送平台支持一下两种推送消息类型:

* `通知栏消息`: 以系统通知栏的形式展现, 不再继续传递到APP中
* `透传消息`: 该消息类型送达用户设备后不会直接显示, 会继续传递到APP中, 并由程序决定如何显示该消息

`通知栏消息` 相对 `透传消息` 传达率要高

由于我们主要采用第三方直接打包的WebAPP, 所以使用的推送方式基本局限于`通知栏消息`. `透传消息` 本身送达率低并且如何显示取决于APP代码, 我们只能使用第三方厂商所提供的相应类型.

#### 关于统一推送联盟

19年12月, 小米正式接入统一推送联盟, 至此国内一线大厂都已接入完成, 不过距离正式开启推送还会有一段时间

#### Android推送集成

各大推送平台都有自己的开发教程, 属于APP开发部分, 这里提及主要思路:

1. 注册相关推送业务账号, 获取相应的`AppID`与`AppKey`
2. 下载相应的SDK, 构建代码
